{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto p-8">
    <h1 class="text-5xl font-black mb-12 text-center bg-gradient-to-r from-emerald-400 to-green-500 bg-clip-text text-transparent">
        üí¨ –ë–û–ï–í–û–ô –ß–ê–¢
    </h1>
    
    <!-- –ü–†–ê–í–ò–õ–ê -->
    <div class="bg-gradient-to-r from-red-500/20 to-orange-500/20 border-2 border-red-400/50 p-6 rounded-3xl mb-8 backdrop-blur-xl">
        <h3 class="text-2xl font-bold mb-4 text-red-300">‚ö†Ô∏è –ü–†–ê–í–ò–õ–ê –ß–ê–¢–ê</h3>
        <div class="grid md:grid-cols-2 gap-4 text-lg text-orange-200">
            <div>- –ë–µ–∑ –º–∞—Ç–∞ –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π</div>
            <div>- –ú–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤</div>
            <div>- –ë–µ–∑ —Å–ø–∞–º–∞ –∏ —Ñ–ª—É–¥–∞</div>
            <div>- –ù–µ —Ä–µ–∫–ª–∞–º–∏—Ä—É–µ–º</div>
        </div>
        <p class="text-red-400 mt-4 font-bold">–ù–∞—Ä—É—à–∏—Ç–µ–ª–∏ ‚Üí –ú–£–¢!</p>
    </div>
    
    <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
    <div class="bg-gray-900/50 backdrop-blur-xl border border-white/10 rounded-3xl p-8 mb-8 max-h-96 overflow-y-auto" id="messages">
        {% for message in messages %}
        <div class="mb-4 p-4 rounded-2xl {% if message.username == session.username %}bg-emerald-500/20 border-emerald-400/50{% else %}bg-gray-800/50 border-gray-600/50{% endif %}">
            <div class="flex items-center gap-3 mb-2">
                <span class="font-black text-xl text-white">{{ message.username }}</span>
                <span class="px-3 py-1 bg-gradient-to-r from-{{ 'emerald' if message.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' else 'blue' }}-500 to-{{ 'emerald' if message.role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' else 'blue' }}-600 rounded-full text-sm font-bold text-white">
                    {{ message.role }}
                </span>
                <span class="text-xs text-gray-400">{{ moment(message.timestamp).fromNow() }}</span>
            </div>
            <p class="text-lg text-gray-200">{{ message.content }}</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- –§–û–†–ú–ê -->
    <form id="chat-form" class="bg-gray-800/50 backdrop-blur-xl p-6 rounded-3xl border border-white/20">
        <div class="flex gap-4">
            <input type="text" id="message-input" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ... (max 200 —Å–∏–º–≤–æ–ª–æ–≤)" 
                   class="flex-1 bg-white/10 border border-white/20 rounded-2xl p-4 text-xl text-white placeholder-white/50 focus:outline-none focus:border-emerald-400" 
                   maxlength="200" required>
            <button type="submit" class="bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-400 hover:to-green-400 px-8 py-4 rounded-2xl font-black text-xl shadow-2xl hover:shadow-emerald-500/25">
                üí¨ –û–¢–ü–†–ê–í–ò–¢–¨
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('chat-form');
    const input = document.getElementById('message-input');
    
    form.onsubmit = function(e) {
        e.preventDefault();
        const content = input.value.trim();
        
        if (!content) return;
        
        fetch('/api/chat/send', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({content: content})
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'ok') {
                input.value = '';
                location.reload();
            } else {
                alert(data.error);
            }
        })
        .catch(err => alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!'));
    };
});
</script>
{% endblock %}
