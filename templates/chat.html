{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-5xl font-black mb-12 text-center bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
        üí¨ –ë–û–ï–í–û–ô –ß–ê–¢
    </h1>
    
    <div class="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-8 border border-white/20 mb-8 max-h-96 overflow-y-auto space-y-4">
        {% for message in messages %}
        <div class="flex group">
            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center font-bold text-lg mr-4 flex-shrink-0">
                {{ message.username[0]|upper }}
            </div>
            <div class="flex-1 bg-black/50 p-4 rounded-2xl border border-white/10 group-hover:border-blue-400/50 transition-all">
                <div class="flex items-center justify-between mb-1">
                    <span class="font-bold text-lg text-white">{{ message.username }}</span>
                    <span class="text-xs text-gray-400">{{ format_time(message.timestamp) }}</span>
                </div>
                <p class="text-gray-200">{{ message.content }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if session.username %}
    <div class="flex gap-4">
        <input id="chatInput" type="text" maxlength="200" 
               class="flex-1 bg-black/50 backdrop-blur-xl border border-white/20 rounded-2xl px-6 py-4 text-lg placeholder-gray-400 focus:outline-none focus:border-blue-400/50 transition-all" 
               placeholder="–ù–∞–ø–∏—à–∏ –≤ –æ–±—â–∏–π —á–∞—Ç... (Enter)">
        <button onclick="sendMessage()" 
                class="bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-400 hover:to-green-400 px-8 py-4 rounded-2xl font-black text-xl shadow-lg hover:shadow-emerald-500/25 transition-all">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
    </div>
    {% else %}
    <div class="text-center py-12 bg-yellow-500/20 border-2 border-yellow-500/30 rounded-3xl">
        <i class="fas fa-lock text-4xl text-yellow-400 mb-4 block"></i>
        <p class="text-xl font-bold text-yellow-300">‚ö†Ô∏è –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —á–∞—Ç–∞</p>
        <a href="/auth/login" class="mt-4 inline-block bg-yellow-500 hover:bg-yellow-400 text-black font-black px-8 py-3 rounded-xl text-lg">
            –í–û–ô–¢–ò
        </a>
    </div>
    {% endif %}
</div>

<script>
function sendMessage() {
    const input = document.getElementById('chatInput');
    const content = input.value.trim();
    
    if (!content) return;
    
    fetch('/api/chat/send', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({content: content})
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'ok') {
            input.value = '';
            location.reload();
        } else {
            alert(data.error);
        }
    });
}

document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});
</script>
{% endblock %}
